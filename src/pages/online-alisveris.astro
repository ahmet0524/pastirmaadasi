---
// src/pages/online-alisveris.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ProductCard from '../components/ProductCard.astro';
import { supabaseAdmin } from '../lib/supabase';

// Supabase'den ürünleri çek
const { data: allProducts } = await supabaseAdmin
  .from('products')
  .select('*')
  .eq('is_active', true)
  .order('created_at', { ascending: false });

// Kategorilere göre ayır
const pastirmaUrunleri = allProducts?.filter(p => p.category === 'Pastırma') || [];
const sucukUrunleri = allProducts?.filter(p => p.category === 'Sucuk') || [];
const mantiUrunleri = allProducts?.filter(p => p.category === 'Mantı') || [];
---

<BaseLayout title="Online Alışveriş" description="Kayseri'nin en kaliteli pastırma, sucuk ve mantı ürünlerini online sipariş edin">
  <Header slot="header" />

  <!-- Hero Banner -->
  <section class="page-hero">
    <div class="container">
      <div class="hero-text">
        <h1>Online Alışveriş</h1>
        <p>Kayseri'nin eşsiz lezzetlerini kapınıza kadar getiriyoruz</p>
        <div class="hero-badges">
          <span class="badge">✓ 1000₺ üzeri ücretsiz kargo</span>
          <span class="badge">✓ Hızlı teslimat</span>
          <span class="badge">✓ Güvenli ödeme</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Kaydırmalı Banner Slider -->
  <section class="banner-slider-section">
    <div class="container">
      <div class="slider-wrapper">
        <div id="banner-slider" class="banner-slider">
          <div class="banner-slide">
            <img src="/assets/image/banners/banner1.jpg" alt="Kampanya 1" loading="lazy">
            <div class="banner-content">
              <h3>Yeni Sezon Kampanyası</h3>
              <p>Tüm pastırmalarda %10 indirim</p>
              <a href="/kategori/pastirma" class="banner-btn">İncele →</a>
            </div>
          </div>
          <div class="banner-slide">
            <img src="/assets/image/banners/banner2.jpg" alt="Kampanya 2" loading="lazy">
            <div class="banner-content">
              <h3>Özel Sucuk Çeşitleri</h3>
              <p>Geleneksel tatlar modern lezzetlerle buluşuyor</p>
              <a href="/kategori/sucuk" class="banner-btn">İncele →</a>
            </div>
          </div>
          <div class="banner-slide">
            <img src="/assets/image/banners/banner3.jpg" alt="Kampanya 3" loading="lazy">
            <div class="banner-content">
              <h3>El Yapımı Mantı</h3>
              <p>Annenizin elinden çıkmış gibi</p>
              <a href="/kategori/manti" class="banner-btn">İncele →</a>
            </div>
          </div>
        </div>

        <button id="prev-btn" class="slider-btn slider-btn-prev" aria-label="Önceki">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <button id="next-btn" class="slider-btn slider-btn-next" aria-label="Sonraki">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>

        <div class="slider-dots" id="slider-dots">
          <button class="slider-dot active" aria-label="Slayt 1"></button>
          <button class="slider-dot" aria-label="Slayt 2"></button>
          <button class="slider-dot" aria-label="Slayt 3"></button>
        </div>
      </div>
    </div>
  </section>

  <!-- Kayseri Pastırması -->
  {pastirmaUrunleri.length > 0 && (
    <section class="products-section">
      <div class="container">
        <div class="section-header">
          <h2>Kayseri Pastırması</h2>
          <a href="/kategori/pastirma" class="view-all-link">
            Tümünü Gör
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="products-grid">
          {pastirmaUrunleri.slice(0, 4).map(product => (
            <ProductCard
              id={product.id}
              slug={product.slug}
              name={product.name}
              price={product.price}
              image={product.images?.[0] || '/assets/image/placeholder.jpg'}
              unit={product.unit}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Kayseri Sucuğu -->
  {sucukUrunleri.length > 0 && (
    <section class="products-section section-gray">
      <div class="container">
        <div class="section-header">
          <h2>Kayseri Sucuğu</h2>
          <a href="/kategori/sucuk" class="view-all-link">
            Tümünü Gör
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="products-grid">
          {sucukUrunleri.slice(0, 5).map(product => (
            <ProductCard
              id={product.id}
              slug={product.slug}
              name={product.name}
              price={product.price}
              image={product.images?.[0] || '/assets/image/placeholder.jpg'}
              unit={product.unit}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Kayseri Mantısı -->
  {mantiUrunleri.length > 0 && (
    <section class="products-section">
      <div class="container">
        <div class="section-header">
          <h2>Kayseri Mantısı</h2>
          <a href="/kategori/manti" class="view-all-link">
            Tümünü Gör
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
        <div class="products-grid">
          {mantiUrunleri.slice(0, 2).map(product => (
            <ProductCard
              id={product.id}
              slug={product.slug}
              name={product.name}
              price={product.price}
              image={product.images?.[0] || '/assets/image/placeholder.jpg'}
              unit={product.unit}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <Footer slot="footer" />
</BaseLayout>

<style>
  .page-hero {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    padding: 4rem 1rem;
    text-align: center;
  }

  .hero-text h1 {
    font-size: 3rem;
    color: white;
    margin-bottom: 1rem;
  }

  .hero-text p {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 1.5rem;
  }

  .hero-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
  }

  .badge {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .banner-slider-section {
    padding: 3rem 1rem;
    background: #f9fafb;
  }

  .slider-wrapper {
    position: relative;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: 0 10px 40px var(--shadow-lg);
  }

  .banner-slider {
    display: flex;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .banner-slide {
    min-width: 100%;
    position: relative;
  }

  .banner-slide img {
    width: 100%;
    height: 450px;
    object-fit: cover;
    display: block;
  }

  .banner-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 3rem 2rem;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, transparent 100%);
    color: white;
  }

  .banner-content h3 {
    font-size: 2.5rem;
    color: white;
    margin-bottom: 0.75rem;
    font-weight: 700;
  }

  .banner-content p {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.95);
    margin-bottom: 1.5rem;
  }

  .banner-btn {
    display: inline-block;
    padding: 0.875rem 2rem;
    background: var(--primary);
    color: white;
    border-radius: 50px;
    font-weight: 700;
    transition: all 0.3s;
    text-decoration: none;
  }

  .banner-btn:hover {
    background: var(--primary-dark);
    transform: translateX(5px);
  }

  .slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.95);
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    z-index: 10;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .slider-btn:hover {
    background: white;
    transform: translateY(-50%) scale(1.1);
  }

  .slider-btn-prev { left: 1.5rem; }
  .slider-btn-next { right: 1.5rem; }

  .slider-dots {
    position: absolute;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 10;
  }

  .slider-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: all 0.3s;
  }

  .slider-dot:hover {
    background: rgba(255, 255, 255, 0.8);
  }

  .slider-dot.active {
    background: white;
    width: 32px;
    border-radius: 6px;
  }

  .products-section {
    padding: 4rem 1rem;
  }

  .section-gray {
    background: #f9fafb;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
  }

  .section-header h2 {
    font-size: 2.25rem;
    font-weight: 700;
  }

  .view-all-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--secondary);
    font-weight: 700;
    font-size: 1.125rem;
    transition: all 0.3s;
  }

  .view-all-link:hover {
    color: var(--primary);
    gap: 0.75rem;
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .hero-text h1 {
      font-size: 2rem;
    }

    .hero-text p {
      font-size: 1rem;
    }

    .hero-badges {
      flex-direction: column;
      align-items: stretch;
    }

    .banner-slide img {
      height: 280px;
    }

    .banner-content {
      padding: 1.5rem;
    }

    .banner-content h3 {
      font-size: 1.5rem;
    }

    .banner-content p {
      font-size: 1rem;
    }

    .slider-btn {
      width: 40px;
      height: 40px;
    }

    .slider-btn-prev { left: 0.75rem; }
    .slider-btn-next { right: 0.75rem; }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .section-header h2 {
      font-size: 1.75rem;
    }

    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
    }
  }
</style>

<script>
  let currentSlide = 0;
  const totalSlides = 3;
  const slider = document.getElementById('banner-slider');
  const dots = document.querySelectorAll('.slider-dot');

  function updateSlider() {
    if (slider) {
      slider.style.transform = `translateX(-${currentSlide * 100}%)`;
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
      });
    }
  }

  document.getElementById('next-btn')?.addEventListener('click', () => {
    currentSlide = (currentSlide + 1) % totalSlides;
    updateSlider();
  });

  document.getElementById('prev-btn')?.addEventListener('click', () => {
    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
    updateSlider();
  });

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      currentSlide = index;
      updateSlider();
    });
  });

  // Otomatik geçiş (5 saniyede bir)
  setInterval(() => {
    currentSlide = (currentSlide + 1) % totalSlides;
    updateSlider();
  }, 5000);
</script>